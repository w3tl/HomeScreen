function getRecord(e){return JSON.parse(localStorage.getItem(e))}function setRecord(e,t){localStorage.setItem(e,JSON.stringify(t))}function settingsClick(){var e=this.parentElement.getAttribute("id"),t=getRecord(storageWindowString+e);document.getElementById("dragcontainer").setAttribute("data-current",e);setting.querySelector(".b-s-main-panel__options ul li input#opt-address").value=t.address;setting.querySelector(".b-s-main-panel__options ul li input#opt-fav").checked=t.fav;setting.querySelector(".b-s-main-panel__options ul li input#opt-title").value=t.title;setting.querySelector(".b-s-main-panel__options ul li input#opt-color").value=t.color;setting.style.display="block"}function starClick(){var e=this.parentElement.getAttribute("id"),t=getRecord(storageWindowString+e);if(this.classList.contains("b-window__button_star_active")){t.fav=false;this.className="b-window__button b-window__button_star"}else{t.fav=true;this.className="b-window__button b-window__button_star b-window__button_star_active"}setRecord(storageWindowString+e,t)}function removeClick(){var e=this.parentElement.getAttribute("id"),t=this.parentElement.getAttribute("data-position");localStorage.removeItem(storageWindowString+e);document.getElementById("dragcontainer").removeChild(this.parentElement);var n=dragContainer.childNodes,r,i;Array.prototype.forEach.call(n,function(e,s){if(s<n.length-1){r=e.getAttribute("data-position");i=e.getAttribute("id");if(r>t){var o=getRecord(storageWindowString+i);o.position-=1;e.setAttribute("data-position",o.position);setRecord(storageWindowString+i,o)}}})}function create(e){var t=document.getElementById("dragcontainer");var n=document.createElement("figure");n.innerHTML='<figure id="'+e.id+'" class="b-window" data-position="'+e.position+'" >      <span class="b-window__button b-window__button_settings"><i class="fa fa-cog"></i></span>      <span class="b-window__button b-window__button_star '+(e.fav?" b-window__button_star_active":"")+'"><i class="fa fa-star"></i></span>       <span class="b-window__button b-window__button_remove"><i class="fa fa-trash"></i></span>       <a href="'+(e.address==undefined?"#":e.address)+'" class="b-window__img-link" title="'+e.title+'" target="_blank">         <div data-title="'+e.title.charAt(0)+'" class="b-window__img"></div>'+'<figcaption class="b-window__title">'+e.title+"</figcaption></a></figure>";var r=findPrevElement(e.position);if(r){r.parentNode.insertBefore(n.firstChild,r.nextSibling)}else{t.insertBefore(n.firstChild,t.firstChild)}document.getElementById(e.id).getElementsByTagName("SPAN")[0].onclick=settingsClick;document.getElementById(e.id).getElementsByTagName("SPAN")[1].onclick=starClick;document.getElementById(e.id).getElementsByTagName("SPAN")[2].onclick=removeClick}function findPrevElement(e){var t=document.getElementById("dragcontainer").getElementsByClassName("b-window"),n=null,r;Array.prototype.forEach.call(t,function(t,i){r=t.getAttribute("data-position");if(e>r){n=t}});if(!n&&t.length!=0){n=null}return n}function findEmptyId(){var e=Object.keys(localStorage);i=1;if(e.length){while(e.indexOf(storageWindowString+i)!=-1){i++}}return i}function findEmptyCaption(e){var t=allStorage(),n="";t.some(function(t){if(t.title.search(e)!=-1){var r=t.title.split(" "),i=parseInt(r[r.length-1]);if(!i){n=1}else if(i>n){n=i}}});return e.concat(" ".concat(n+1))}function createAll(){var e=allStorage(),t=document.getElementById("b-main-title__edit");try{t.innerHTML=JSON.parse(localStorage.getItem("com.HomeScreen.Settings")).title}catch(n){t.innerHTML="Home Screen"}e.some(function(e){create(e)})}function deleteAll(){var e=Object.keys(localStorage);e.some(function(e){if(e.search("com.HomeScreen")!=-1&&e.search("Settings")==-1)localStorage.removeItem(e)})}function allStorage(){var e=[],t=Object.keys(localStorage);t.some(function(t){if(t.search(storageWindowString)!=-1){e.push(getRecord(t))}});return e}var storageWindowString="com.HomeScreen.id";window.onload=function(){var e=document.getElementById("dragcontainer");createAll();new Sortable(e,{onEnd:function(t){var n=e.getElementsByClassName("b-window"),r;Array.prototype.forEach.call(n,function(e,t){e.setAttribute("data-position",t+1);r=getRecord(storageWindowString+e.getAttribute("id"));r.position=t+1;setRecord(storageWindowString+e.getAttribute("id"),r)})}});document.getElementById("b-window-add").onclick=function(){var t=e.getElementsByClassName("b-window"),n=t.length>0?parseInt(t[t.length-1].getAttribute("data-position"))+1:1,r;r={id:findEmptyId(),title:findEmptyCaption("New site"),address:"",position:n,fav:false,color:"3ff4d1"};if(document.getElementById("see-favs").classList.contains("b-toggle__button_active")){r.fav=true}create(r);setRecord(storageWindowString+r.id,r)};document.querySelector(".b-s-top-panel__close .fa-trash-o").onclick=function(){document.getElementById("export-data").value=""};document.getElementById("export").onclick=function(){var e=allStorage(),t=document.getElementById("export-data");t.value=localStorage.getItem("com.HomeScreen.Settings")+"\n";e.forEach(function(n,r,i){t.value+=JSON.stringify(n)+(r<e.length-1?"\n":"")});t.select()};document.getElementById("import").onclick=function(){var e=document.getElementById("export-data").value,t=0,n;e=e.split("\n");try{e.forEach(function(e,t,r){n=JSON.parse(e);if(n.id){setRecord(storageWindowString+n.id,e)}else{localStorage.setItem("com.HomeScreen.Settings",e)}})}catch(r){console.error(r.message)}location.reload()};document.getElementById("export-button").onclick=function(){document.getElementById("d-export").style.display="block"};document.getElementById("remove-all").onclick=function(){deleteAll();location.reload()};document.getElementById("see-all").onclick=function(){var t=e.getElementsByClassName("b-window");Array.prototype.forEach.call(t,function(e,t){e.style.display="inline-block"});this.className="b-toggle__button b-toggle__button_active";document.getElementById("see-favs").className="b-toggle__button"};document.getElementById("see-favs").onclick=function(){var t=e.getElementsByClassName("b-window"),n;Array.prototype.forEach.call(t,function(e,t){n=getRecord(storageWindowString+e.getAttribute("id"));if(n.fav){e.style.display="inline-block"}else{e.style.display="none"}});this.className="b-toggle__button b-toggle__button_active";document.getElementById("see-all").className="b-toggle__button"};document.getElementById("b-main-title__edit-icon").onclick=function(){var e=document.getElementById("b-main-title").firstChild;if(e.getAttribute("contenteditable")!="true"){e.setAttribute("contenteditable",true);this.firstChild.className="fa";e.focus()}};var t=setting=document.getElementById("settings");document.getElementById("b-main-title__edit").addEventListener("focusout",function(){if(this.getAttribute("contenteditable")=="true"){this.nextElementSibling.firstChild.className="fa fa-pencil";this.setAttribute("contenteditable",false);setRecord("com.HomeScreen.Settings",{title:this.innerHTML})}});var n=document.querySelectorAll(".b-s-top-panel__close .fa-close"),r=function(){this.parentElement.parentElement.parentElement.style.display="none"};Array.prototype.forEach.call(n,function(e,t){e.addEventListener("click",r,false)});document.getElementById("b-button-save").onclick=function(){var e=document.getElementById("dragcontainer").getAttribute("data-current"),t=setting.querySelector(".b-s-main-panel .b-s-main-panel__options ul li input#opt-title").value,n=getRecord(storageWindowString+e),r=document.getElementById(e).lastChild,i=document.getElementById(e).querySelector(".b-window__button_star");n.title=t;n.address=setting.querySelector(".b-s-main-panel .b-s-main-panel__options ul li input#opt-address").value;n.fav=setting.querySelector(".b-s-main-panel .b-s-main-panel__options ul li input#opt-fav").checked;n.color=setting.querySelector(".b-s-main-panel .b-s-main-panel__options ul li input#opt-color").value;r.lastChild.innerHTML=t;r.childNodes[1].setAttribute("data-title",t.charAt(0));r.childNodes[1].style.backgroundColor="#"+n.color;i.className=n.fav?"b-window__button b-window__button_star b-window__button_star_active":"b-window__button b-window__button_star";setRecord(storageWindowString+e,n);setting.style.display="none"}}